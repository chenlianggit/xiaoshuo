<?php
 class tree { protected $model; protected $pidkey; protected $icon = array('　│ ', '　├─', '　└─', '　　'); public function __construct($model, $pidkey = 'pid') { $this->model = $model; $this->pidkey = $pidkey; } public function getList($zym_15 = 0, $zym_13 = '*', $zym_16 = array(), $zym_17 = 'ordernum asc,id asc', $zym_12 = 1) { $zym_16[$this->pidkey] = $zym_15; $zym_14 = $this->model->field($zym_13)->where($zym_16)->order($zym_17)->select(); if ($zym_14 === null) return array(); $zym_19 = array(); foreach ($zym_14 as $zym_18) { $zym_18['level'] = $zym_12; $zym_19[] = $zym_18; $zym_10 = $this->getlist($zym_18[$this->model->getPk()], $zym_13, $zym_16, $zym_17, $zym_12 + 1); $zym_19 = array_merge($zym_19, $zym_10); } return $zym_19; } public function getIconList($zym_19, $zym_6 = 1) { if ($zym_6 > 1) { $zym_5[] = array_fill(0, $zym_6 - 1, $this->icon['3']); } else { $zym_5 = array(); } foreach ($zym_19 as $zym_7 => &$zym_18) { $zym_18['showname'] = $zym_18['name']; if ($zym_18['level'] >= $zym_6) { $icon = $this->icon['2']; $zym_5[$zym_18['level'] - $zym_6] = $this->icon['3']; foreach (array_slice($zym_19, $zym_7 + 1) as $zym_11) { if ($zym_11['level'] < $zym_18['level']) { $zym_5[$zym_18['level'] - $zym_6] = $this->icon['3']; break; } elseif ($zym_11['level'] == $zym_18['level']) { $icon = $this->icon['1']; $zym_5[$zym_18['level'] - $zym_6] = $this->icon['0']; break; } } $zym_18['showname'] = implode('', array_slice($zym_5, 0, $zym_18['level'] - $zym_6)) . $icon . $zym_18['name']; } } return $zym_19; } public function getSonList($zym_15 = 0, $zym_13 = '*', $zym_16 = array(), $zym_8 = 3, $zym_17 = 'ordernum asc,id asc', $zym_12 = 1) { $zym_16[$this->pidkey] = $zym_15; $zym_14 = $this->model->field($zym_13)->where($zym_16)->order($zym_17)->select(); if ($zym_14 === null) return array(); $zym_19 = array(); foreach ($zym_14 as $zym_18) { $zym_18['level'] = $zym_12; if (isset($zym_18['module'])) { $zym_18['url'] = ($zym_18['module'] == '') ? '' : U($zym_18['module'] . '.' . $zym_18['controller'] . '.' . $zym_18['action']); unset($zym_18['module'], $zym_18['controller'], $zym_18['action']); } if ($zym_12 < $zym_8) { $zym_18['sons'] = $this->getSonList($zym_18[$this->model->getPk()], $zym_13, $zym_16, $zym_8, $zym_17, $zym_12 + 1); } $zym_19[] = $zym_18; } return $zym_19; } public function getAuthList($zym_15 = 0, $zym_13 = '*', $zym_16 = array(), $zym_17 = 'ordernum asc,id asc', $zym_12 = 1) { $zym_16[$this->pidkey] = $zym_15; $zym_14 = $this->model->field($zym_13)->where($zym_16)->order($zym_17)->select(); if ($zym_14 === null) return array(); $zym_19 = array(); foreach ($zym_14 as $zym_18) { $zym_18['level'] = $zym_12; if ($zym_12 < 4) { $zym_9=$this->getAuthList($zym_18[$this->model->getPk()], $zym_13, $zym_16, $zym_17, $zym_12 + 1); if ($zym_12 == 3) { $zym_19 = array_merge($zym_19, array($zym_18), $zym_9); } else { $zym_18['sons'] = $zym_9; $zym_19[] = $zym_18; } }else{ $zym_19[] = $zym_18; } } return $zym_19; } }
?>