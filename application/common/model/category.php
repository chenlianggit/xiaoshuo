<?php
 class CategoryModel extends Model { public function add($zym_11) { return $this->insert($zym_11); } public function edit($zym_11) { return $this->update($zym_11); } public function del($zym_13) { return $this->where($zym_13)->delete(); } public function dataAppend($zym_10) { $zym_10['parent'] = $this->getParentList($zym_10['id']); $zym_10['son'] = (array)$this->where(array('pid' => $zym_10['id']))->field('id,name,key')->select(); $zym_10['sibling'] = (array)$this->where(array('pid' => $zym_10['pid']))->field('id,name,key')->select(); $zym_10['url'] = U('novelsearch.list.category', array('key' => $zym_10['key'])); return $zym_10; } public function getParentList($zym_14) { $zym_10 = $this->where(array('id' => $zym_14))->field('id,pid,name,key')->find(); if ($zym_10['pid'] == '0') return array($zym_10); $zym_12[] = $zym_10; $zym_12 = array_merge($zym_12, $this->getParentList($zym_10['pid'])); return $zym_12; } public function getSonList($zym_14 = 0, $zym_6 = 1, $zym_5 = 1) { $zym_9 = M('category')->field('id,name,key')->where(array('pid' => $zym_14))->select(); if ($zym_6 > $zym_5) { foreach ($zym_9 as &$zym_8) { $zym_8['son'] = $this->getSonList($zym_8['id'], $zym_6, $zym_5 + 1); } } return $zym_9; } public function getSiblingslist($zym_14) { } public function getinfo() { } public function getinfoByKey($zym_7) { $zym_10 = cache::get('categoryinfobykey_' . $zym_7); if (!$zym_10) { if ($zym_7 !== 'all') { $zym_10 = $this->field('id,key,name')->where(array('key' => $zym_7))->find(); } if (empty($zym_10)){ $zym_10 = array('id' => 0, 'key' => 'all', 'name' => C('caption_allcateogry')); $zym_10['url'] = U('novelsearch.list.category', array('key' => $zym_10['key'])); }else{ $zym_10['url'] = U('novelsearch.list.category', array('key' => $zym_10['key'])); cache::set('categoryinfobykey_' . $zym_7, $zym_10,1800); } } return $zym_10; } }
?>