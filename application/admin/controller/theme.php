<?php
 class themeController extends AdminController { public function init() { parent::init(); } public function indexAction() { $zym_15 = pt::import(APP_PATH . '/common/config.php'); $this->defaulttpl = $zym_15['tpl_theme']; $this->list = M('theme')->getlist(); $this->view->config=$zym_15; $this->view->urlkey=$this->config->get('default_module','index').'.index.index'; $this->display(); } public function setAction() { $zym_14=$this->input->get('tpl','str'); $zym_13=$this->model('theme')->getinfo($zym_14); $this->cookie->del('THEME_' . MODULE_NAME); $zym_5=$this->config->get('wap_theme'); switch($zym_13['type']){ case 'wap': $this->model('config')->where(array('key' => 'wap_theme'))->edit(array('value' => $zym_14)); $zym_5=$zym_14; break; case 'all': $this->model('config')->where(array('key' => 'wap_theme'))->edit(array('value' => $zym_14)); $this->model('config')->where(array('key' => 'tpl_theme'))->edit(array('value' => $zym_14)); $zym_5=$zym_14; break; default: $this->model('config')->where(array('key' => 'tpl_theme'))->edit(array('value' => $zym_14)); } if ($this->config->get('wap_type') == 2) { $zym_8 = $this->request->getSiteCode($this->config->get('wap_domain')); $zym_9 = array( 'tpl_theme' => $zym_5, 'html' => 0, ); if (!F(APP_PATH . '/common/' . $zym_8 . '.config.php', $zym_9)) { $this->error('创建手机站配置文件失败，请检查' . APP_PATH . '/common/' . '文件夹权限', 0, 0); } } $this->success('设置默认模版成功'); } public function configjumpAction() { $zym_7=$this->input->get('type','str'); $zym_15=pt::import(APP_PATH.'/common/config.php'); if ($zym_7=='mobile'){ $this->redirect(U('config',array('tpl'=>$zym_15['wap_theme']))); }else{ $this->redirect(U('config',array('tpl'=>$zym_15['tpl_theme']))); } } public function configAction() { $zym_14 = I('get.tpl', 'str', ''); $zym_12 = TPL_PATH . '/' . $zym_14 . '/config.php'; if (!$this->view->config = pt::import($zym_12)) { $this->view->config = array(); } if (IS_POST) { $zym_9 = array(); foreach ($_POST as $zym_6 => $zym_10) { if ($zym_10['name'] && $zym_10['key']) { $zym_9[$zym_10['key']] = array( 'name' => $zym_10['name'], 'value' => $zym_10['value'], ); } } F($zym_12, $zym_9); $this->success('修改成功'); } $this->tpl = I('get.tpl', 'str'); $this->display(); } public function delAction() { $zym_14 = I('get.tpl', 'str', ''); $zym_11 = I('get.id', 'str', ''); $zym_12 = TPL_PATH . '/' . $zym_14 . '/config.php'; $zym_9 = pt::import($zym_12); if (isset($zym_9[$zym_11])) { unset($zym_9[$zym_11]); F($zym_12, $zym_9); $this->success('删除成功'); } $this->error('没有找到对应的配置项'); } }
?>