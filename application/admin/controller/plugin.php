<?php
class PluginController extends AdminController{ public function init() { $this->tableName='plugin'; parent::init(); } public function indexAction() { $this->list=$this->model->getlist(); $this->display(); } public function installAction() { $zym_10=I('get.key','en',''); $zym_11=parse_ini_file(APP_PATH.'/common/plugin/'.$zym_10.'/config.ini'); $zym_7=plugin::$zym_5; $zym_6=explode('|',$zym_11['hook']); foreach($zym_6 as $zym_9){ $zym_7[$zym_9][]=$zym_10; $zym_7[$zym_9]=array_unique($zym_7[$zym_9]); } M('config')->where(array('key'=>'plugin'))->edit(array('value'=>json_encode($zym_7))); $this->success('安装成功'); } public function uninstallAction() { $zym_10=I('get.key','en',''); $zym_11=parse_ini_file(APP_PATH.'/common/plugin/'.$zym_10.'/config.ini'); $zym_7=plugin::$zym_5; $zym_6=explode('|',$zym_11['hook']); foreach($zym_6 as $zym_9){ if(!empty($zym_7[$zym_9]) && in_array($zym_10,$zym_7[$zym_9])){ unset($zym_7[$zym_9][array_search($zym_10,$zym_7[$zym_9])]); } } M('config')->where(array('key'=>'plugin'))->edit(array('value'=>json_encode($zym_7))); $this->success('卸载成功'); } public function upgradeAction() { } public function configAction() { $zym_10=I('request.pluginkey','en',''); $zym_8=pt::import(APP_PATH.'/common/plugin/'.$zym_10.'/config.php'); if ($zym_8){ if (IS_POST){ foreach($zym_8 as &$zym_9){ if (isset($_POST[$zym_9['key']])){ $zym_9['value']=$_POST[$zym_9['key']]; } } F(APP_PATH.'/common/plugin/'.$zym_10.'/config.php',$zym_8); $this->success('修改成功'); } $this->pluginkey=$zym_10; $this->list=$zym_8; $this->display(); }else{ $this->error('该插件无配置项'); } } }
?>