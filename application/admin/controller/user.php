<?php
class UserController extends AdminController{ public function init() { $this->tableName='admin_user'; parent::init(); } public function indexAction() { $this->list=$this->model->getlist(); $this->display(); } public function addAction() { if (IS_POST){ $zym_9['user_id']=M('user')->where(array('name'=>I('name','username','')))->getfield('id'); $zym_9['intro']=I('intro','str'); $zym_9['group_id']=I('groupid','int',0); $zym_9['status']=I('status','int',0); $zym_9['create_user_id']=$_SESSION['admin']['userid']; $zym_9['create_time']=NOW_TIME; $zym_9['login_num']=0; if($this->model->add($zym_9)){ $this->success('添加成功',U('index')); }else{ $this->error('添加失败'); } } $this->grouplist=M('admin_group')->field('id,name')->select(); $this->display(); } public function editAction() { $zym_11=I('request.id','int',0); $zym_10=$this->model->field('id,user_id,group_id,intro,status')->where(array('id'=>$zym_11))->find(); if (IS_POST){ $zym_9['intro']=I('intro','str'); $zym_9['group_id']=I('groupid','int',0); $zym_9['status']=I('status','int',0); $zym_9['update_user_id']=$_SESSION['admin']['userid']; $zym_9['update_time']=NOW_TIME; $zym_9['id']=$zym_11; if ($this->model->edit($zym_9)){ $this->success('修改成功',U('index')); }else{ $this->error('修改失败'); } } $this->grouplist=M('admin_group')->field('id,name')->select(); $zym_10['name']=dc::get('user',$zym_10['user_id'],'name'); $this->info=$zym_10; $this->display(); } public function ajaxAction() { $zym_11=I('request.id','int',0); $zym_7=I('param','username',''); if ($zym_7){ if ($zym_5=M('user')->where(array('name'=>$zym_7))->getfield('id')){ $zym_6=$this->model->where(array('user_id'=>user_id))->getfield('id'); if ($zym_6 && $zym_6!=$zym_11){ $zym_8=array('status'=>'n','info'=>'您输入的用户名已经使用了'); }else{ $zym_8=array('status'=>'y','info'=>'帐号可以使用'); } }else{ $zym_8=array('status'=>'n','info'=>'您输入的用户名不存在'); } }else{ $zym_8=array('status'=>'n','info'=>'输入的用户名有误'); } $this->ajax($zym_8); } }
?>