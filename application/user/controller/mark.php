<?php
 class markController extends UserController { public function indexAction() { $zym_8 = M('user_mark'); $zym_9 = I('get.userid', 'int', 0); $this->view->userid = $zym_9; $this->view->markname = $this->userinfo['name']; $this->view->marklist = $zym_8->getmarklist($zym_8->getmarkinfo($zym_9)); $this->view->userpagesign='mark'; $this->display('mark'); } public function delAction() { $zym_9 = $this->userinfo['id']; if(isset($_GET['novelid'])){ $zym_7=[$this->input->get('novelid','int')]; }else{ $zym_7 = I('caseid', 'arr', array()); } (new user_markModel())->remove($zym_9,$zym_7); foreach ($zym_7 as $zym_5) { M('novelsearch_info')->where(array('id' => $zym_5))->setdec('marknum'); $this->model->rm('novelsearch_info',$zym_5); } $this->success('移除小说成功'); } public function clearAction() { $zym_9 = $this->userinfo['id']; $zym_7=M('user_mark')->where(array('userid' => $zym_9))->getfield('novelid',true); M('user_mark')->where(array('userid' => $zym_9))->delete(); foreach ($zym_7 as $zym_5) { M('novelsearch_info')->where(array('id' => $zym_5))->setdec('marknum'); $this->model->rm('novelsearch_info',$zym_5); } cache::rm('markinfo_' . $zym_9); $this->success('清空书架成功'); } public function addAction() { $zym_5 = I('get.novelid', 'int', '0'); $zym_6 = I('get.chapterid', 'int', 1); $zym_9 = $this->userinfo['id']; M('user_mark')->addusermark($zym_9, $zym_5, $zym_6); M('novelsearch_info')->where(array('id' => $zym_5))->setinc('marknum'); $this->model->rm('novelsearch_info',$zym_5); $this->success('处理成功'); } }
?>