<?php
class ManageController extends AdminController{ public function init() { $this->tableName='user'; parent::init(); } public function indexAction() { $zym_7=$this->_parsemap(); $this->page=I('request.page','int',1); $this->pagesize=C('admin_pagesie',null,20); $zym_9=$this->model->field('id,name,reg_time,login_ip,reg_ip,login_time,status')->where($zym_7)->page($this->page)->limit($this->pagesize)->order('id desc')->getlist(); $this->totalnum=$this->model->where($zym_7)->count(); $this->pagenum=ceil($this->totalnum/$this->pagesize); $this->list=$zym_9; if (IS_AJAX){ $this->ajax(array('data'=>$this->list,'totalnum'=>$this->totalnum,'pagenum'=>$this->pagenum)); }else{ $this->display(); } } public function editAction() { $zym_6=I('request.id'); if ($zym_6 && $zym_5=$this->model->find($zym_6)){ if(IS_POST){ $zym_8=$_POST; if ($zym_8['password']==''){ unset($zym_8['password']); }else{ $zym_8['salt']=substr(md5(NOW_TIME),0,6); $zym_8['password']=md5(md5($zym_8['password']).$zym_8['salt']); } if ($this->model->edit($zym_8)!==false){ $this->success('修改成功'); }else{ $this->error('修改失败'); } } $this->info=$zym_5; $this->display(); }else{ $this->error('找不到指定的用户'); } } }
?>