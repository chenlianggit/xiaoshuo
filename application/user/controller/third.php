<?php
class ThirdController extends CommonController{ public function init() { parent::init(); if (!IS_LOGIN){ $this->redirect(U('user.public.login')); } $this->view->userpagesign='third'; } public function indexAction() { $this->display('third'); } public function bindAction() { $zym_7 = I('get.type', 'str', ''); $zym_7 = in_array($zym_7, array('qq', 'weibo')) ? $zym_7 : 'qq'; $zym_9 = $this->config->get('siteurl') . U('user.third.bind', array('type' => $zym_7)); if (empty($_GET['code'])) { $zym_6 = oauth::getInstance($zym_7)->authorize($zym_9); $this->redirect($zym_6); } else { $zym_5 = I('get.code', 'str', ''); $zym_8 = oauth::getInstance($zym_7)->getAccessToken($zym_5, $zym_9); if (!is_array($zym_8)) $this->error($zym_8, U('user.third.index')); M('user')->edit(array($zym_7 . 'id' => $zym_8['openid'],'id' => $this->userinfo['id'])); $this->success('绑定成功！', U('user.third.index')); } } public function unbindAction() { $zym_7 = I('get.type', 'str', ''); $zym_7 = in_array($zym_7, array('qq', 'weibo')) ? $zym_7 : 'qq'; M('user')->edit(array($zym_7 . 'id' => '','id' => $this->userinfo['id'])); $this->success('解除绑定成功！', U('user.third.index')); } }
?>