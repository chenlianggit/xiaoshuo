<?php
 class apicontroller extends controller { public function getchapterAction() { $zym_10 = $this->input->request('novelid', 'int', 0); $zym_8 = $this->input->request('chapterid', 'int', 0); $zym_9 = $this->input->request('siteid', 'int', 0); $zym_7 = new novelsearch_chapterModel(); if ($zym_9) { $zym_13 = $zym_7->setTableId($zym_10)->where(['novelid' => $zym_10, 'siteid' => $zym_9, 'oid' => $zym_8])->find(); } else { $zym_12 = $zym_7->getweightlistbyoid($zym_10, $zym_8); if (count($zym_12['free']) > 0) { $zym_13 = $zym_7->selectchapter($zym_12['free']); } else { $zym_13 = $zym_7->selectchapter($zym_12['vip']); } } $zym_5 = $zym_7->getinfo($zym_10, $zym_13['id'], [], true, false, 'id', 'read'); $zym_11 = (new CollectModel($zym_5['siteid'], 'siteid'))->getchapter($zym_5['url'], $zym_5['time']); if ($zym_11['status'] == 1) { $zym_5['content'] = showchapter($zym_11['data']); } else { $zym_5['content'] = $this->config->get('greenread_errormsg', '转码失败！请您使用右上换源切换源站阅读或者直接前往源网站进行阅读！'); } $zym_6 = [ 'info' => ['id' => $zym_5['oid'], 'title' => $zym_5['name'], 'content' => br2p($zym_5['content']),'url'=>$zym_5['url_read']], 'from' => ['id' => $zym_5['siteid'], 'url' => $zym_5['url']], 'next' => ['id' => $zym_5['nextinfo']['id'], 'url' => $zym_5['nextinfo']['url']], 'prev' => ['id' => $zym_5['preinfo']['id'], 'url' => $zym_5['preinfo']['url']], ]; return $this->success($zym_6); } }
?>