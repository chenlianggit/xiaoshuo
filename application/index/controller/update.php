<?php
class updateController extends CommonController{ public function init() { $this->response->disableRender(); } public function infoAction() { $zym_9=M(); $zym_8=$zym_9->fetchall('SELECT *,count(*) as num FROM `ptcms_novelsearch_log` group by siteid,fromid having num>1 order by num desc'); foreach($zym_8 as $zym_7=>$zym_11){ $zym_12=$zym_9->fetchall("select * from `ptcms_novelsearch_log` where fromid='{$zym_11['fromid']}' and siteid='{$zym_11['siteid']}'"); foreach($zym_12 as $zym_5=>$zym_6){ if ($zym_5>0){ $zym_9->query("delete from `ptcms_novelsearch_log` where fromid='{$zym_11['fromid']}' and siteid='{$zym_11['siteid']}' and novelid='{$zym_6['novelid']}'"); $zym_9->query("delete from `ptcms_novelsearch_info` where id='{$zym_6['novelid']}'"); } } } } public function chapterAction(){ $zym_9=M(); for($zym_10=0;$zym_10<100;$zym_10++){ $zym_8=$zym_9->fetchall("SELECT *,count(*) as num FROM `ptcms_novelsearch_chapter_{$zym_10}` group by url having num>1 order by num desc"); if(!$zym_8) continue; var_dump(count($zym_8)); ob_flush(); flush(); foreach($zym_8 as $zym_7=>$zym_11){ $zym_12=$zym_9->fetchall("SELECT * FROM `ptcms_novelsearch_chapter_{$zym_10}` where url='{$zym_11['url']}'"); foreach($zym_12 as $zym_5=>$zym_6){ if ($zym_5>0){ $zym_9->query("delete FROM `ptcms_novelsearch_chapter_{$zym_10}` where id='{$zym_6['id']}'"); } } } } } public function lockAction(){ $zym_9=M(); for($zym_10=0;$zym_10<100;$zym_10++){ $zym_8=$zym_9->query("ALTER TABLE `ptcms_novelsearch_chapter_{$zym_10}`  ADD UNIQUE INDEX (`url`);"); var_dump($zym_8); } } }
?>