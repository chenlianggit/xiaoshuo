var PTSV={t:null,ajax:0};$ptm.search={init:function(a){a.on("keydown click",function(){$ptm.search.suggest(a)});$(document).on("tap",".searchsuggest li,.searchhistory a",function(){var b=$(this).html();$ptm.search.go(b)});$(".pt-search-textbtn").on("tap",function(){$ptm.search.go(a.val())});$(document).on("tap",".searchhistroyclear",function(){$ptm.alert.open({title:"提示",content:"确认清空搜索历史么",okval:"确定",cancelval:"取消",okfunc:function(){$ptm.search.history.clear()}})});$ptm.search.history.init()},history:{init:function(){list=JSON.parse(localStorage.getItem("searchlist"));if(list&&typeof list=="object"){var a='<dt><i class="fa fa-trash searchhistroyclear"><b>清空历史</b></i>搜索历史</dt>';$.each(list,function(c,b){a+='<dd><a class="noicon ptm-text-cut">'+b+"</a></dd>"});$(".searchhistory").html(a)}},add:function(a){var b=[];b.push(a);list=JSON.parse(localStorage.getItem("searchlist"));if(list&&typeof list=="object"){$.each(list,function(d,c){if(c!=a){b.push(c)}});if(b.length>6){b=b.slice(0,6)}}localStorage.setItem("searchlist",JSON.stringify(b))},clear:function(){localStorage.setItem("searchlist",JSON.stringify([]))},},go:function(a){if(a){$ptm.search.history.add(a);window.location=basesearchurl+encodeURIComponent(a)}else{$ptm.toast("关键词不能为空")}},suggest:function(a){if(PTSV.t){clearTimeout(PTSV.t)}PTSV.t=setTimeout(function(){var b=a.val();if(b){$.get("/api/search/suggest.json",{key:a.val()},function(d){if(d.status==1){var c="";$.each(d.data,function(f,e){if(f<5){c+="<li>"+d.data[f]+"</li>"}});$(".searchsuggest").show().html(c)}},"json")}else{$(".searchsuggest").hide().html("")}},200)}};