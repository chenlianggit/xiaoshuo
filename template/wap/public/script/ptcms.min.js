(function(a){a.extend(a.fn,{scrollTo:function(c,d){d=d==undefined?200:d;var l=d/10,e=c/l,g=this,k=null,j=f=g.scrollTop();var b=function(){if(c<0&&(j-f<c||j<=0)){window.clearInterval(k);return false}else{if(c>0&&j-f>c){window.clearInterval(k);return false}else{if(c==0){window.clearInterval(k);return false}}}g.scrollTop(j);j=parseInt(j+e);if(c<0&&j<0){g.scrollTop(0)}};k=window.setInterval(function(){b()},10)}})})($);var $pt={},w=$(window).width(),h=$(window).height();(function(a){$pt.config={base:{width:w,height:h,page:1,totalpage:1,},chapter:{init:0,info:{id:"",title:"",content:"",},novel:{id:"",name:"",marked:0,},from:{id:"",url:"",},next:{id:"",url:"",},prev:{id:"",url:"",},},reader:{status:0,fontsize:16,theme:"default",moon:0,style:0,cache:0,}};$pt.chapter={init:function(c,b){$pt.chapter.initreader(b);$pt.chapter.initchapter(c);$pt.chapter.menu.init();$pt.chapter.menu.cache.load()},initreader:function(b){if(b){$pt.config.reader=a.extend($pt.config.reader,b)}$pt.config.base.rh=parseInt($pt.config.reader.fontsize*1.8*1.5);if($pt.config.reader.style==0){a(".pt-reader").removeClass("about");a(".pt-reader .content").css({"width":$pt.config.base.width,"height":"auto","-webkit-column-width":"inherit"});a(".pt-reader").off("swipeRight");a(".pt-reader").off("swipeLeft")}else{a(".pt-reader").addClass("about");a(".pt-reader .body").css({"height":null,"width":$pt.config.base.width});a(".pt-reader .content").css({"width":$pt.config.base.width,"height":$pt.config.base.height,"-webkit-column-width":$pt.config.base.width,});a(".pt-reader .body .aboutheader").width($pt.config.base.width)}a(".pt-menu .cache .c"+$pt.config.reader.cache).addClass("active").siblings().removeClass("active");a(".option.style li").eq($pt.config.reader.style).addClass("active").siblings().removeClass("active");$pt.chapter.menu.fontsize.change();a("body").removeAttr("class").addClass("theme-"+$pt.config.reader.theme);a(".option.theme .theme-"+$pt.config.reader.theme).addClass("active").siblings().removeClass("active");if($pt.config.reader.moon){a(".menu-moon").addClass("ptm-hide");a(".menu-sun").removeClass("ptm-hide");a("body").addClass("theme-moon")}},initchapter:function(b){var d=0;if(b&&b!=[]){$pt.config.chapter=a.extend($pt.config.chapter,b);d=(b.info==undefined||b.info.lastid==undefined)?$pt.config.chapter.info.id:b.info.lastid}if($pt.config.chapter.init==0){a(".pt-reader").show();a(".loading").hide();if($pt.config.chapter.novel.marked){a(".menu-mark").addClass("ptm-hide");a(".menu-marked").removeClass("ptm-hide")}else{a(".menu-marked").addClass("ptm-hide");a(".menu-mark").removeClass("ptm-hide")}$pt.config.chapter.init=1;var e=JSON.parse(JSON.stringify($pt.config.chapter));delete e.novel;window.localStorage.setItem("cc_"+$pt.config.chapter.novel.id+"_"+$pt.config.chapter.info.id,JSON.stringify(e))}else{$pt.chapter.menu.cache.load();history.pushState(null,"",$pt.config.chapter.info.url);a("title").html($pt.config.chapter.info.title);a.post("/api/reader/updatemark.json",{novelid:$pt.config.chapter.novel.id,chapterid:$pt.config.chapter.info.id},function(c){},"json")}a(".pt-reader .aboutheader .title").text($pt.config.chapter.info.title);a(".pt-reader .content").html("").removeClass("anim").css("-webkit-transform","translate3d(0px, 0px, 0px)").html('<p class="title">'+$pt.config.chapter.info.title+"</p>"+$pt.config.chapter.info.content+'<p class="endline"></p>');if($pt.config.reader.style==0){a(".pt-reader .body").height(Math.ceil(a(".pt-reader .body").height()/($pt.config.base.height-$pt.config.base.rh))*($pt.config.base.height-$pt.config.base.rh));a(".pt-reader").scrollTop(0)}else{a(".pt-reader .content").css("-webkit-transform","translate3d(0px, 0px, 0px)");$pt.config.base.totalpage=1+(a(".pt-reader .content p").last().offset().left-15)/($pt.config.base.width-15);if(d==$pt.config.chapter.next.id&&d>0){$pt.config.base.page=$pt.config.base.totalpage;a(".pt-reader .content").css("-webkit-transform","translate3d(-"+($pt.config.base.page-1)*($pt.config.base.width-15)+"px, 0px, 0px)")}else{$pt.config.base.page=1}a(".page").html($pt.config.base.page+"/"+$pt.config.base.totalpage);setTimeout(function(){a(".pt-reader .content").addClass("anim")},600)}},menu:{init:function(){var c=$pt.config.base.width,b=$pt.config.base.height;a(".pt-reader").on("click",function(e){if($pt.config.reader.status==0){var d=e.clientX,g=e.clientY;if(d/c<0.4){$pt.chapter.menu.prev()}else{if(d/c>0.6){$pt.chapter.menu.next()}else{if(g/b<0.3){$pt.chapter.menu.prev()}else{if(g/b>0.7){$pt.chapter.menu.next()}else{$pt.chapter.menu.show()}}}}}});a(".pt-menu .bg").on("click",function(){$pt.chapter.menu.hide();a(".pt-menu .button").removeClass("active")});a(".pt-menu .menu-more").on("tap",$pt.chapter.menu.more);a(".pt-menu .menu-mark").on("tap",$pt.chapter.menu.mark.add);a(".pt-menu .menu-marked").on("tap",$pt.chapter.menu.mark.remove);a(".pt-menu .menu-moon").on("tap",$pt.chapter.menu.moon.apply);a(".pt-menu .menu-sun").on("tap",$pt.chapter.menu.moon.unapply);a(".pt-menu .menu-cache").on("tap",$pt.chapter.menu.cache.trigger);
a(".pt-menu .menu-setting").on("tap",$pt.chapter.menu.setting.trigger);a(".pt-menu .menu-change").on("tap",$pt.chapter.menu.change.load);a(document).on("tap",".menu-op.change li",$pt.chapter.menu.change.change);a(".pt-menu .center .next").on("tap",$pt.chapter.chapter.next);a(".pt-menu .center .prev").on("tap",function(){$pt.chapter.chapter.prev(1)})},fontsize:{inc:function(){$pt.config.reader.fontsize++;a.post("/api/reader/fontsize.json",{fontsize:$pt.config.reader.fontsize},function(){$pt.chapter.menu.fontsize.change()},"json")},dec:function(){$pt.config.reader.fontsize--;a.post("/api/reader/fontsize.json",{fontsize:$pt.config.reader.fontsize},function(){$pt.chapter.menu.fontsize.change()},"json")},change:function(){a(".option.fontsize span").text($pt.config.reader.fontsize);var b=a(".pt-reader .content .title").css("fontSize",parseInt($pt.config.reader.fontsize)+2);a(".pt-reader .content").css("fontSize",$pt.config.reader.fontsize);if($pt.config.reader.style==1){var c=1+(a(".pt-reader .content p").last().offset().left-15)/($pt.config.base.width-15);$pt.config.base.totalpage=c>$pt.config.base.page?c:$pt.config.base.page;a(".page").html($pt.config.base.page+"/"+$pt.config.base.totalpage)}}},change:{load:function(){a(this).toggleClass("active").siblings().removeClass("active");a(".pt-menu .change").toggle().siblings(".menu-op").hide();a.get("/api/reader/getsamechapter.json",{novelid:$pt.config.chapter.novel.id,chapterid:$pt.config.chapter.info.id},function(b){if(b.status==1){if(b.data.length>0){var c="";a.each(b.data,function(e,d){if(d.siteid==$pt.config.chapter.from.id){c+='<li class="ptm-list-view-cell ptm-text-cut ptm-text-left active" data-siteid="'+d.siteid+'">['+d.sitename+"] "+d.name+"</li>"}else{c+='<li class="ptm-list-view-cell ptm-text-cut ptm-text-left" data-siteid="'+d.siteid+'">['+d.sitename+"] "+d.name+"</li>"}});if(b.data.length<4){a(".menu-op.change .ptm-list-view").height(b.data.length*40)}else{a(".menu-op.change .ptm-list-view").height(160)}}else{c+='<li class="ptm-list-view-cell ptm-text-cut active" data-siteid="'+v.siteid+'">'+v.sitename+" - "+v.name+"</li>"}a(".menu-op.change .ptm-list-view").html(c)}},"json");event.preventDefault();return false},change:function(){var b=a(this).data("siteid");$ptm.loading.open("换源中...");data=$pt.chapter.chapter._get($pt.config.chapter.novel.id,$pt.config.chapter.info.id,b);$ptm.loading.close();$pt.chapter.initchapter(data);a(this).addClass("active").siblings().removeClass("active");$ptm.toast("换源成功");a(".pt-menu .menu-change").removeClass("active");a(".pt-menu .change").toggle();$pt.chapter.menu.hide()}},setting:{trigger:function(){a(this).toggleClass("active").siblings().removeClass("active");a(".pt-menu .setting").toggle().siblings(".menu-op").hide();a(".option.style li").on("tap",function(){var b=a(this).index();a.post("/api/reader/readstyle.json",{v:b},function(){$pt.config.reader.style=b;$pt.chapter.initreader($pt.config.reader);$pt.chapter.initchapter([])},"json")});a(".option.theme .theme-area").on("tap",function(){$pt.config.reader.theme=a(this).data("theme");a("body").removeAttr("class").addClass("theme-"+$pt.config.reader.theme);a(".option.theme .theme-"+$pt.config.reader.theme).addClass("active").siblings().removeClass("active");a.post("/api/reader/theme.json",{v:$pt.config.reader.theme},function(){},"json")});a(".option.fontsize .inc").on("tap",$pt.chapter.menu.fontsize.inc);a(".option.fontsize .dec").on("tap",$pt.chapter.menu.fontsize.dec)}},cache:{trigger:function(){a(this).toggleClass("active").siblings().removeClass("active");a(".pt-menu .cache").toggle().siblings(".menu-op").hide();a(".pt-menu .cache li").on("tap",function(){$pt.chapter.menu.cache.set(a(this).data("num"))})},set:function(b){$pt.config.reader.cache=b;a(".pt-menu .cache .c"+b).addClass("active").siblings().removeClass("active");a.post("/api/reader/cache.json",{v:b},function(){$pt.chapter.menu.cache.load()},"json")},load:function(){if(!$pt.config.reader.cache){return}var g=$pt.config.chapter.novel.id,e=$pt.config.chapter.info.id;var d=parseInt(window.localStorage.getItem("cc_"+g+"_start"));var c=parseInt(window.localStorage.getItem("cc_"+g+"_end"));var j=e-1,b=parseInt(e)+parseInt($pt.config.reader.cache);if(b>=$pt.config.chapter.novel.num){b=parseInt($pt.config.chapter.novel.num)+1}if(j<1){j=1}if(j>d){for(i=d;i<j;i++){window.localStorage.removeItem("cc_"+g+"_"+i)}}if(b<=c){for(i=b;i<c;i++){window.localStorage.removeItem("cc_"+g+"_"+i)}}for(i=j;i<b;i++){$pt.chapter.chapter._getasync(g,i)}window.localStorage.setItem("cc_"+g+"_start",j);window.localStorage.setItem("cc_"+g+"_end",b)}},more:function(){a(this).toggleClass("active");a(".pt-menu .more").toggle()},moon:{apply:function(){a(".pt-menu .menu-op").hide();a(".menu-moon").addClass("ptm-hide");a(".menu-sun").removeClass("ptm-hide");a("body").addClass("theme-moon");a.post("/api/reader/moon.json",{v:1},function(){$pt.config.reader.moon=1;$ptm.toast("切换到夜间模式")},"json")},unapply:function(){a(".pt-menu .menu-op").hide();a("body").removeClass("theme-moon");
a(".menu-sun").addClass("ptm-hide");a(".menu-moon").removeClass("ptm-hide");a.post("/api/reader/moon.json",{v:0},function(){$pt.config.reader.moon=0;$ptm.toast("切换到日间模式")},"json")}},mark:{add:function(){a.post("/api/reader/mark.json",{id:$pt.config.chapter.novel.id,"chapterid":$pt.config.chapter.info.id,type:"add"},function(b){if(b.status==1){$ptm.toast("成功加入收藏夹");a(".menu-mark").addClass("ptm-hide");a(".menu-marked").removeClass("ptm-hide")}else{alert(b.info)}},"json")},remove:function(){a.post("/api/reader/mark",{id:$pt.config.chapter.novel.id,type:"remove"},function(b){if(b.status==1){$ptm.toast("取消收藏成功");a(".menu-marked").addClass("ptm-hide");a(".menu-mark").removeClass("ptm-hide")}else{alert(b.info)}},"json")}},trigger:function(){if($pt.config.reader.status==1){$pt.chapter.menu.hide()}else{$pt.chapter.menu.show()}},show:function(){$pt.config.reader.status=1;a(".pt-menu").show()},hide:function(){$pt.config.reader.status=0;a(".pt-menu").hide()},next:function(){if($pt.config.reader.style==0){if(a(".pt-reader").scrollTop()+$pt.config.base.height==a(".pt-reader .body").height()){$pt.chapter.chapter.next()}else{$pt.chapter.page.next()}}else{if($pt.config.base.page==$pt.config.base.totalpage){$pt.chapter.chapter.next()}else{$pt.chapter.page.next()}}},prev:function(){if($pt.config.reader.style==0){if(a(".pt-reader").scrollTop()==0){$pt.chapter.chapter.prev()}else{$pt.chapter.page.prev()}}else{if($pt.config.base.page==1){$pt.chapter.chapter.prev()}else{$pt.chapter.page.prev()}}},},page:{next:function(){if($pt.config.reader.style==0){a(".pt-reader").scrollTo($pt.config.base.height-$pt.config.base.rh,300)}else{$pt.config.base.page++;a(".page").html($pt.config.base.page+"/"+$pt.config.base.totalpage);a(".pt-reader .content").css("-webkit-transform","translate3d(-"+($pt.config.base.page-1)*($pt.config.base.width-15)+"px, 0px, 0px)")}},prev:function(){if($pt.config.reader.style==0){a(".pt-reader").scrollTo($pt.config.base.rh-parseInt($pt.config.base.height),300)}else{$pt.config.base.page--;a(".page").html($pt.config.base.page+"/"+$pt.config.base.totalpage);a(".pt-reader .content").css("-webkit-transform","translate3d(-"+($pt.config.base.page-1)*($pt.config.base.width-15)+"px, 0px, 0px)")}}},chapter:{next:function(){if($pt.config.chapter.next.id==0){window.location.href=$pt.config.chapter.next.url}else{var b=$pt.chapter.chapter.get($pt.config.chapter.novel.id,$pt.config.chapter.next.id,0);$pt.chapter.initchapter(b)}},prev:function(b){if($pt.config.chapter.prev.id==0){window.location.href=$pt.config.chapter.prev.url}else{data=$pt.chapter.chapter.get($pt.config.chapter.novel.id,$pt.config.chapter.prev.id,0);if(b){data.info.lastid=b}$pt.chapter.initchapter(data)}},get:function(e,b,c){if(c==undefined){c=0}var d=JSON.parse(window.localStorage.getItem("cc_"+e+"_"+b));if(d===null||d.info.content.length<200){d=$pt.chapter.chapter._get(e,b,c);if(d===null||!d.info||d.info.content.length<200){d=$pt.chapter.chapter._get(e,b,c)}if(d===null||!d.info||d.info.content.length<200){d=$pt.chapter.chapter._get(e,b,c)}}return d},_get:function(e,b,c){var d={};a.ajax({method:"POST",url:"/api/reader/getchapter.json",data:{novelid:e,chapterid:b,siteid:c},async:false,dataType:"json",success:function(g){if(g.status==1){d=g.data;if(d.info.content.length>200){window.localStorage.setItem("cc_"+e+"_"+b,JSON.stringify(d))}}}});return d},_getasync:function(e,b,c){var d=JSON.parse(window.localStorage.getItem("cc_"+e+"_"+b));if(d===null||d.info.content.length<200){a.ajax({method:"POST",url:"/api/reader/getchapter.json",data:{novelid:e,chapterid:b,siteid:c},dataType:"json",success:function(g){if(g.status==1){d=g.data;if(d.info.content.length>200){window.localStorage.setItem("cc_"+e+"_"+b,JSON.stringify(d))}}}})}}}}})($);